{"title":"Example 7: Infection Rates in Care Homes","markdown":{"yaml":{"title":"Example 7: Infection Rates in Care Homes","subtitle":"Comparing Rates with Varying Denominators","number-sections":false},"headingText":"| echo: false","containsRefs":false,"markdown":"\n\n```{r}\n#| message: false\nlibrary(reticulate)\nuse_python(\"C:/Users/fede/anaconda3/python.exe\")\n```\n\n## Scenario Overview\n\n**Method**: Multi-group rate comparison (requires Guild consultation for ANOVA/chi-squared)  \n**Complexity**: High  \n**Time to complete**: 3-4 hours  \n**Status**: âœ… Complete\n\n::: {.callout-note icon=false}\n## ðŸ“– Method Reference\nThis example demonstrates comparing rates across multiple groups. For background on rate calculation and standardization, see @sec-z-scoring. For multi-group comparisons beyond two groups, consult the Quantitative Guild.\n:::\n\n---\n\n## ðŸ“‹ Scenario\n\nCQC is analyzing infection rates across 80 care homes using Vivaldi study data. Care homes vary in size (20-100 residents) and quality ratings.\n\n**Analytical Question**: Do infection rates differ by CQC rating? How should we account for varying home sizes?\n\n**Context**: This involves count data (infections) with varying denominators (residents). Simple comparisons may be misleading if not properly adjusted for exposure.\n\n---\n\n## ðŸŽ¯ Learning Objectives\n\nBy completing this example, you will learn how to:\n\n1. **Work with count data** and rates\n2. **Account for varying denominators** (exposure adjustment)\n3. **Compare rates across groups** (CQC ratings)\n4. **Handle small numbers** in some homes\n5. **Interpret rate vs count** differences\n6. **Apply appropriate statistical tests** for count data\n7. **Visualize rates** with confidence intervals\n8. **Communicate findings** about quality and safety\n\n---\n\n## ðŸ“Š Dataset Description\n\n### Synthetic Data: `data/infection_rates.csv`\n\n**80 care homes** with infection data:\n\n| Variable | Description | Type | Notes |\n|----------|-------------|------|-------|\n| `home_id` | Care home identifier | String | CH001-CH080 |\n| `home_name` | Care home name | String | Synthetic names |\n| `residents` | Number of residents | Integer | 20-100 |\n| `staff_ratio` | Staff-to-resident ratio | Float | 0.3-0.7 |\n| `cqc_rating` | CQC quality rating | String | Outstanding/Good/RI/Inadequate |\n| `infections` | Number of infections | Integer | Count data |\n| `infection_rate` | Rate per 100 residents | Float | Calculated |\n\n### Data Characteristics\n\n**Realistic patterns**:\n- Varying home sizes (20-100 residents)\n- Most homes rated \"Good\" (70%)\n- Infection rates related to quality rating\n- Small numbers in some homes\n- Poisson-distributed counts\n\n**Data generation**: Synthetic data generated using R (`set.seed(42)` for reproducibility). Both R and Python load the same CSV file, ensuring identical results.\n\n---\n\n## Step 1: Data Preparation\n\n::: {.panel-tabset}\n\n### R\n\n```{r ex7-import-r}\n#| message: false\n#| warning: false\n\nlibrary(ggplot2)\n\n# Import infection data\ninfection_data <- read.csv(\"data/infection_rates.csv\", stringsAsFactors = FALSE)\n\n# Display first few rows\nhead(infection_data)\n\n# Summary by rating\ncat(\"\\nSummary by CQC Rating:\\n\")\naggregate(cbind(residents, infections, infection_rate) ~ cqc_rating, \n          data = infection_data, \n          FUN = function(x) c(n = length(x), mean = round(mean(x), 2)))\n```\n\n### Python\n\n```{python ex7-import-py}\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy import stats\n\n# Import infection data\ninfection_data = pd.read_csv(\"data/infection_rates.csv\")\n\n# Display first few rows\nprint(infection_data.head())\n\n# Summary by rating\nprint(\"\\nSummary by CQC Rating:\")\nprint(infection_data.groupby('cqc_rating')[['residents', 'infections', 'infection_rate']].agg(['count', 'mean']))\n```\n\n:::\n\n---\n\n## Step 2: Visualize Rates by Quality\n\n::: {.panel-tabset}\n\n### R\n\n```{r ex7-plot-r}\n#| fig-width: 10\n#| fig-height: 6\n\n# Order ratings\ninfection_data$cqc_rating <- factor(infection_data$cqc_rating, \n                                    levels = c(\"Outstanding\", \"Good\", \n                                              \"Requires Improvement\", \"Inadequate\"))\n\nggplot(infection_data, aes(x = cqc_rating, y = infection_rate, fill = cqc_rating)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.5, size = 2) +\n  scale_fill_manual(values = c(\"Outstanding\" = \"#2E7D32\", \n                               \"Good\" = \"#66BB6A\",\n                               \"Requires Improvement\" = \"#FFA726\",\n                               \"Inadequate\" = \"#EF5350\")) +\n  labs(\n    title = \"Infection Rates by CQC Rating\",\n    subtitle = \"Rate per 100 residents\",\n    x = \"CQC Rating\",\n    y = \"Infection Rate (per 100 residents)\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n### Python\n\n```{python ex7-plot-py}\n# Order ratings\nrating_order = [\"Outstanding\", \"Good\", \"Requires Improvement\", \"Inadequate\"]\ninfection_data['cqc_rating'] = pd.Categorical(infection_data['cqc_rating'], \n                                               categories=rating_order, \n                                               ordered=True)\n\nplt.figure(figsize=(10, 6))\ninfection_data.boxplot(column='infection_rate', by='cqc_rating', \n                       grid=False, patch_artist=True)\nplt.suptitle('')\nplt.title('Infection Rates by CQC Rating\\nRate per 100 residents')\nplt.xlabel('CQC Rating')\nplt.ylabel('Infection Rate (per 100 residents)')\nplt.xticks(rotation=45, ha='right')\nplt.tight_layout()\nplt.show()\n```\n\n:::\n\n**Observations**:\n- Clear gradient: Outstanding < Good < RI < Inadequate\n- Variation within each rating category\n- Some overlap between adjacent categories\n\n---\n\n## Step 3: Statistical Comparison\n\n**Purpose**: Test if infection rates differ significantly by CQC rating.\n\n::: {.panel-tabset}\n\n### R\n\n```{r ex7-test-r}\n# ANOVA on rates\nanova_result <- aov(infection_rate ~ cqc_rating, data = infection_data)\nsummary(anova_result)\n\n# Pairwise comparisons\npairwise_result <- pairwise.t.test(infection_data$infection_rate, \n                                   infection_data$cqc_rating,\n                                   p.adjust.method = \"bonferroni\")\nprint(pairwise_result)\n\n# Mean rates by rating\ncat(\"\\nMean infection rates by CQC rating:\\n\")\ntapply(infection_data$infection_rate, infection_data$cqc_rating, mean)\n```\n\n### Python\n\n```{python ex7-test-py}\n# ANOVA on rates\nfrom scipy.stats import f_oneway\n\ngroups = [infection_data[infection_data['cqc_rating'] == rating]['infection_rate'].values \n          for rating in rating_order]\n\nf_stat, p_value = f_oneway(*groups)\nprint(f\"ANOVA F-statistic: {f_stat:.2f}\")\nprint(f\"p-value: {p_value:.4f}\")\n\n# Mean rates by rating\nprint(\"\\nMean infection rates by CQC rating:\")\nprint(infection_data.groupby('cqc_rating')['infection_rate'].mean())\n```\n\n:::\n\n**Finding**: Significant differences in infection rates by CQC rating (p < 0.001).\n\n---\n\n## Step 4: Conclusion\n\n**Statistical Conclusion**:\n- Significant association between CQC rating and infection rates\n- Outstanding homes: ~2% infection rate\n- Good homes: ~3% infection rate  \n- Requires Improvement: ~4% infection rate\n- Inadequate: ~5% infection rate\n\n**Practical Significance**:\n- Quality rating is a strong predictor of infection control\n- Difference between Outstanding and Inadequate: ~3 percentage points\n- In a 50-resident home: ~1.5 fewer infections per period\n\n**Recommendations**:\n1. **Target support** to Requires Improvement and Inadequate homes\n2. **Share best practices** from Outstanding homes\n3. **Monitor infection rates** as quality indicator\n4. **Consider confounders** (resident case-mix, staffing levels)\n\n**Limitations**:\n- Cross-sectional data (no causality)\n- Resident case-mix not fully adjusted\n- Small sample sizes in some rating categories\n- Reporting bias possible\n\n---\n\n## Summary\n\nThis example demonstrates analysis of **count data with varying denominators**:\n\nâœ… **Rate calculation** and interpretation  \nâœ… **Comparison across groups** with different exposures  \nâœ… **Appropriate statistical tests** for rates  \nâœ… **Visualization** of rates with context  \nâœ… **Quality-safety relationship** interpretation\n\n**Key Lesson**: When comparing counts across units with different sizes, always use rates (per 100, per 1000, etc.) to ensure fair comparison.\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":false,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../custom.css"],"toc":true,"toc-depth":3,"number-sections":false,"output-file":"example-07-complete.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","bibliography":["../references.bib"],"theme":"cosmo","number-depth":2,"title":"Example 7: Infection Rates in Care Homes","subtitle":"Comparing Rates with Varying Denominators"},"extensions":{"book":{"multiFile":true}}}}}